<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3132/3132644.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¥æ˜Ÿæ˜Ÿ - æ¨‚å¯Œè‡ªè¡Œè»Š</title>
<link rel="manifest" href="manifest.json">
    <style>
        body { margin: 0; background: #050510; color: #fff; overflow: hidden; font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; touch-action: none; }
        canvas { display: block; background: radial-gradient(circle, #1a1a2e 0%, #050510 100%); }
        
        #ui { position: absolute; top: 15px; left: 15px; font-size: 20px; font-weight: bold; pointer-events: none; z-index: 10; text-shadow: 2px 2px 4px #000; }
        #lvl-tag { color: #00ff00; font-size: 26px; margin-bottom: 5px; }

        #menu { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            display: flex; justify-content: center; align-items: center; 
            background: rgba(0,0,0,0.85); z-index: 1000; 
        }
        .box { 
            background: #16213e; padding: 40px; border-radius: 20px; 
            border: 3px solid #00ff00; text-align: center; min-width: 320px;
            box-shadow: 0 0 50px rgba(0,255,0,0.3);
        }
        
        h1 { color: #fdbb2d; font-size: 32px; margin: 0 0 15px 0; }
        .win-title { color: #00ff00; font-size: 38px; animation: shine 1s infinite; }
        @keyframes shine { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        
        button { 
            background: #00ff00; border: none; padding: 18px 60px; 
            font-size: 28px; font-weight: bold; border-radius: 12px; 
            cursor: pointer; margin: 20px 0; color: #000;
            box-shadow: 0 6px 0 #008800;
        }
        button:hover { background: #33ff33; }
        button:active { transform: translateY(4px); box-shadow: none; }

        .dev-info { margin-top: 25px; font-size: 16px; color: #888; border-top: 1px solid #333; padding-top: 15px; }
        .brand { color: #fdbb2d; font-weight: bold; font-size: 20px; }
    </style>
</head>
<body>

    <div id="ui">
        <div id="lvl-tag">é—œå¡: <span id="lvl">1</span> / 10</div>
        åˆ†æ•¸: <span id="s">0</span> | ç”Ÿå‘½: <span id="l">3</span> | å€’æ•¸: <span id="t">15</span>s
    </div>

    <div id="menu">
        <div class="box">
            <h1 id="m-title">æ¥æ˜Ÿæ˜ŸæŒ‘æˆ°</h1>
            <div id="m-content">
                <p>æ¯ 15 ç§’å‡ä¸€é—œï¼Œæ’é 10 é—œå³ç²å‹ï¼</p>
                <p style="color:#00ff00; font-weight:bold;">ğŸŸ¢ ç¶ çƒï¼šæ¿å­ç¸®çŸ­ã€æ‰£ 30 åˆ†</p>
            </div>
            <button id="start-btn">é–‹å§‹éŠæˆ²</button>
            <div class="dev-info">æœ¬éŠæˆ²ç”± <span class="brand">æ¨‚å¯Œè‡ªè¡Œè»Š</span> é–‹ç™¼</div>
        </div>
    </div>

    <canvas id="c"></canvas>

<script>
    const cvs = document.getElementById('c'), ctx = cvs.getContext('2d');
    const sEl = document.getElementById('s'), lEl = document.getElementById('l'), lvlEl = document.getElementById('lvl'), tEl = document.getElementById('t');
    const menu = document.getElementById('menu'), startBtn = document.getElementById('start-btn');
    const mTitle = document.getElementById('m-title'), mContent = document.getElementById('m-content');

    let score = 0, lives = 3, running = false, level = 1, timeLeft = 15;
    let stars = [], player = { x: 0, w: 100 }, baseSpeed = 4;
    let spawnT = null, timerT = null, bgmT = null, audioCtx = null;

    // --- éŸ³æ•ˆç³»çµ± (å¼·åŒ–ç©©å®šæ€§ï¼šå³ä½¿å‡ºéŒ¯ä¹Ÿä¸å½±éŸ¿éŠæˆ²é–‹å§‹) ---
    function initAudio() {
        try {
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!audioCtx) audioCtx = new AudioContext();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        } catch(e) { console.warn("éŸ³æ•ˆç³»çµ±æœªå•Ÿå‹•"); }
    }

    function playNote(f, t, d, v = 0.1) {
        if (!audioCtx || audioCtx.state !== 'running') return;
        try {
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.type = t; o.frequency.value = f;
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        } catch(e) {}
    }

    function bgmLoop() {
        let step = 0;
        const melody = [262, 330, 392, 523, 440, 349, 392, 330]; 
        bgmT = setInterval(() => {
            if (running) {
                playNote(melody[step % 8], 'triangle', 0.4, 0.02);
                step++;
            }
        }, 250);
    }

    // --- éŠæˆ²é‚è¼¯ ---
    function resize() {
        cvs.width = window.innerWidth; cvs.height = window.innerHeight;
        player.x = cvs.width / 2 - player.w / 2;
    }
    window.onresize = resize; resize();

    function move(e) {
        let x = e.touches ? e.touches[0].clientX : e.clientX;
        player.x = x - player.w / 2;
    }
    window.addEventListener('mousemove', move);
    window.addEventListener('touchmove', move, { passive: false });

    // é»æ“Šé–‹å§‹
    startBtn.onclick = function(e) {
        e.preventDefault();
        console.log("é–‹å§‹éŠæˆ²...");
        
        // 1. åˆå§‹åŒ–éŸ³æ•ˆ (å¤±æ•—ä¹Ÿä¸å½±éŸ¿)
        initAudio();
        
        // 2. å•Ÿå‹•éŠæˆ²ç‹€æ…‹
        score = 0; lives = 3; level = 1; timeLeft = 15; baseSpeed = 4;
        player.w = 100; stars = [];
        sEl.innerText = 0; lEl.innerText = 3; lvlEl.innerText = 1; tEl.innerText = 15;
        
        running = true;
        menu.style.display = 'none';
        
        // 3. å•Ÿå‹•å¾ªç’°
        clearTimeout(spawnT); clearInterval(timerT); clearInterval(bgmT);
        spawn();
        bgmLoop();
        
        timerT = setInterval(() => {
            if (!running) return;
            timeLeft--;
            tEl.innerText = timeLeft;
            if (timeLeft <= 0) {
                if (level < 10) {
                    level++; timeLeft = 15; baseSpeed += 0.2;
                    lvlEl.innerText = level;
                    playNote(1000, 'sine', 0.3, 0.2);
                } else {
                    gameWin();
                }
            }
        }, 1000);
    };

    function gameWin() {
        running = false;
        clearInterval(timerT); clearInterval(bgmT);
        menu.style.display = 'flex';
        mTitle.innerHTML = "<span class='win-title'>æ­å–œç ´é—œï¼</span>";
        mContent.innerHTML = `<p>æ’é 10 é—œæŒ‘æˆ°ï¼</p><p style='color:#fdbb2d; font-size:24px;'>æœ€çµ‚å¾—åˆ†ï¼š${score}</p>`;
        startBtn.innerText = "å†ç©ä¸€æ¬¡";
    }

    function gameOver() {
        running = false;
        clearInterval(timerT); clearInterval(bgmT);
        menu.style.display = 'flex';
        mTitle.innerText = "éŠæˆ²çµæŸ";
        mContent.innerHTML = `<p>æŒ‘æˆ°å¤±æ•—ï¼Œè«‹å†æ¥å†å²ï¼</p><p style='font-size:20px;'>æœ€çµ‚å¾—åˆ†ï¼š${score}</p>`;
        startBtn.innerText = "é‡æ–°æŒ‘æˆ°";
    }

    function spawn() {
        if(!running) return;
        const r = Math.random();
        let t = 'g', c = '#fdbb2d'; // é‡‘
        if(r > 0.65 && r <= 0.8) { t = 'r'; c = '#ff4757'; } // ç´…
        else if(r > 0.8) { t = 'b'; c = '#00ff00'; } // ç¶ 
        
        stars.push({x: Math.random()*(cvs.width-30), y: -30, t: t, c: c});
        spawnT = setTimeout(spawn, Math.max(200, 1000 - score/12));
    }

    function loop() {
        ctx.clearRect(0, 0, cvs.width, cvs.height);
        if(running) {
            // ç•«æ¿å­
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x, cvs.height-60, player.w, 15);

            for(let i = stars.length - 1; i >= 0; i--) {
                let s = stars[i];
                s.y += baseSpeed + (score/2000);
                
                ctx.fillStyle = s.c;
                ctx.beginPath(); ctx.arc(s.x, s.y, 13, 0, Math.PI*2); ctx.fill();

                if(s.y > cvs.height-65 && s.y < cvs.height-45 && s.x > player.x && s.x < player.x + player.w) {
                    if(s.t == 'g') { score += 10; playNote(880, 'sine', 0.1); }
                    else if(s.t == 'r') { player.w = Math.min(cvs.width, player.w * 1.3); playNote(600, 'triangle', 0.2); }
                    else if(s.t == 'b') { // ç¶ çƒï¼šæ‰£ 30 åˆ†ä¸”æ¿å­ç¸®çŸ­
                        player.w = Math.max(30, player.w * 0.5);
                        score = Math.max(0, score - 30);
                        playNote(150, 'square', 0.3, 0.3);
                    }
                    sEl.innerText = score; stars.splice(i, 1);
                } else if(s.y > cvs.height) {
                    if(s.t == 'g') {
                        lives--; lEl.innerText = lives;
                        playNote(100, 'sawtooth', 0.2);
                        if(lives <= 0) gameOver();
                    }
                    stars.splice(i, 1);
                }
            }
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>